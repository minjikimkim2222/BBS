package com.example.user;

import java.sql.Connection;
import java.sql.DriverManager;
import java.sql.PreparedStatement;
import java.sql.ResultSet;
import java.sql.SQLException;

public class UserDBProcess {

	private String jdbcDriver = "com.mysql.cj.jdbc.Driver"; // 드라이버 로딩
	private String jdbcUrl = "jdbc:mysql://localhost:3306/testdb?characterEncoding=UTF-8";
	private String user = "root";
	private String password = "olivia0929";

	public int login(String userId, String userPassword) {
		try {
			Class.forName(jdbcDriver);
		} catch (ClassNotFoundException e) {
			e.printStackTrace();
		}

		String sql = "SELECT password FROM user WHERE id = ?";

		try {
			Connection connection = DriverManager.getConnection(jdbcUrl, user, password);
			PreparedStatement preparedStatement = connection.prepareStatement(sql);

			preparedStatement.setString(1, userId);

			ResultSet resultSet = preparedStatement.executeQuery();

			if (resultSet.next()) {
				if (resultSet.getString("password").equals(userPassword)) {
					return (1); // 로그인 성공
				} else
					return (0); // 로그인 실패
			}

		} catch (SQLException e) {
			e.printStackTrace();
		}
		return (-1); // 데이터베이스의 오류
	}

	public int register(String userid, String userPw, String userGender, String userEmail) {
		try {
			Class.forName(jdbcDriver);
		} catch (ClassNotFoundException e) {
			e.printStackTrace();
		}

		String sql = "INSERT INTO user VALUES (?, ?, ?, ?)";

		try {
			Connection connection = DriverManager.getConnection(jdbcUrl, user, password);
			PreparedStatement preparedStatement = connection.prepareStatement(sql);

			preparedStatement.setString(1, userid);
			preparedStatement.setString(2, userPw);
			preparedStatement.setString(3, userGender);
			preparedStatement.setString(4, userEmail);

			int resultValue = preparedStatement.executeUpdate();

			if (resultValue > 0) {
				return (1); // 정상 실행
			}
		} catch (SQLException e) {
//			e.printStackTrace();
			System.out.println(e.getMessage());
		}
		return (-1); // 데이터베이스 오류
	}

}
